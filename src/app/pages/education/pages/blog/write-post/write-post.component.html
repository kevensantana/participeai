<div class="write-post-page">
  <!-- Header -->
  <section class="write-header">
    <div class="home-voltar">
      <a routerLink="/education">Voltar</a>
    </div>
    <div class="container">
      <div class="write-header-content">
        <div class="write-header-title">
          <span class="write-icon">‚úèÔ∏è</span>
          <h1 class="font-title">Escrever Artigo</h1>
        </div>
        <p class="write-header-subtitle">
          Compartilhe seu conhecimento sobre sustentabilidade e ajude a construir um futuro mais verde
        </p>
      </div>
    </div>
  </section>

  <div class="container write-content">
    <!-- Tabs -->
    <div class="write-tabs">
      <div class="tabs-nav">
        <button 
          class="tab-btn" 
          [class.active]="activeTab === 'write'"
          (click)="setActiveTab('write')">
          <span class="tab-icon">‚úèÔ∏è</span>
          Escrever
        </button>
        <button 
          class="tab-btn" 
          [class.active]="activeTab === 'preview'"
          (click)="setActiveTab('preview')">
          <span class="tab-icon">üëÅÔ∏è</span>
          Visualizar
        </button>
      </div>

      <!-- Write Tab -->
      <div class="tab-content" [class.active]="activeTab === 'write'">
        <form [formGroup]="writeForm" (ngSubmit)="onSubmit('review')" class="write-form">
          <div class="form-grid">
            <!-- Main Form -->
            <div class="main-form">
              <div class="form-card">
                <h3 class="form-card-title">
                  <span class="card-icon">üìÑ</span>
                  Informa√ß√µes do Artigo
                </h3>
                
                <div class="form-group">
                  <label for="title">T√≠tulo do Artigo *</label>
                  <input 
                    type="text" 
                    id="title" 
                    formControlName="title"
                    placeholder="Ex: Como Reduzir o Desperd√≠cio de Alimentos em Casa"
                    [class.error]="writeForm.get('title')?.invalid && writeForm.get('title')?.touched">
                  <div class="error-message" *ngIf="writeForm.get('title')?.invalid && writeForm.get('title')?.touched">
                    O t√≠tulo √© obrigat√≥rio e deve ter pelo menos 10 caracteres.
                  </div>
                </div>

                <div class="form-group">
                  <label for="excerpt">Resumo/Descri√ß√£o *</label>
                  <textarea 
                    id="excerpt" 
                    formControlName="excerpt"
                    placeholder="Escreva um resumo atrativo do seu artigo (m√°ximo 200 caracteres)"
                    maxlength="200"
                    rows="3"
                    [class.error]="writeForm.get('excerpt')?.invalid && writeForm.get('excerpt')?.touched"></textarea>
                  <div class="char-counter">{{ getCharacterCount(writeForm.get('excerpt')?.value || '') }}/200 caracteres</div>
                  <div class="error-message" *ngIf="writeForm.get('excerpt')?.invalid && writeForm.get('excerpt')?.touched">
                    O resumo √© obrigat√≥rio.
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="category">Categoria *</label>
                    <select 
                      id="category" 
                      formControlName="categorySlug"
                      [class.error]="writeForm.get('categorySlug')?.invalid && writeForm.get('categorySlug')?.touched">
                      <option value="">Selecione uma categoria</option>
                      <option *ngFor="let category of categories$ | async" [value]="category.slug">
                        {{ category.name }}
                      </option>
                    </select>
                    <div class="error-message" *ngIf="writeForm.get('categorySlug')?.invalid && writeForm.get('categorySlug')?.touched">
                      Selecione uma categoria.
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="tags">Tags</label>
                    <input 
                      type="text" 
                      id="tags" 
                      formControlName="tags"
                      placeholder="Ex: sustentabilidade, economia, dicas">
                    <div class="help-text">Separe as tags com v√≠rgulas</div>
                  </div>
                </div>

                <div class="form-group">
                  <label for="image">URL da Imagem de Capa</label>
                  <input 
                    type="url" 
                    id="image" 
                    formControlName="image"
                    placeholder="https://exemplo.com/imagem.jpg">
                </div>
              </div>

              <div class="form-card">
                <h3 class="form-card-title">
                  <span class="card-icon">‚úèÔ∏è</span>
                  Conte√∫do do Artigo
                </h3>
                
                <div class="form-group">
                  <textarea 
                    formControlName="content"
                    placeholder="Escreva seu artigo aqui... Use markdown para formata√ß√£o:

                      **Negrito** para texto em negrito
                      *It√°lico* para texto em it√°lico
                      # T√≠tulo Principal
                      ## Subt√≠tulo
                      - Lista com marcadores
                      1. Lista numerada

                      Exemplo de par√°grafo com informa√ß√µes importantes sobre sustentabilidade..."
                    rows="20"
                    [class.error]="writeForm.get('content')?.invalid && writeForm.get('content')?.touched"></textarea>
                  
                  <div class="content-stats">
                    <span>{{ getWordCount(writeForm.get('content')?.value || '') }} palavras</span>
                    <span>~{{ estimateReadTime(writeForm.get('content')?.value || '') }} min de leitura</span>
                  </div>
                  
                  <div class="error-message" *ngIf="writeForm.get('content')?.invalid && writeForm.get('content')?.touched">
                    O conte√∫do √© obrigat√≥rio e deve ter pelo menos 100 caracteres.
                  </div>
                </div>
              </div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
              <div class="form-card">
                <h3 class="form-card-title">
                  <span class="card-icon">üë§</span>
                  Informa√ß√µes do Autor
                </h3>
                
                <div class="form-group">
                  <label for="author">Nome Completo *</label>
                  <input 
                    type="text" 
                    id="author" 
                    formControlName="author"
                    placeholder="Seu nome"
                    [class.error]="writeForm.get('author')?.invalid && writeForm.get('author')?.touched">
                  <div class="error-message" *ngIf="writeForm.get('author')?.invalid && writeForm.get('author')?.touched">
                    O nome √© obrigat√≥rio.
                  </div>
                </div>

                <div class="form-group">
                  <label for="email">E-mail *</label>
                  <input 
                    type="email" 
                    id="email" 
                    formControlName="email"
                    placeholder="seu@email.com"
                    [class.error]="writeForm.get('email')?.invalid && writeForm.get('email')?.touched">
                  <div class="error-message" *ngIf="writeForm.get('email')?.invalid && writeForm.get('email')?.touched">
                    E-mail v√°lido √© obrigat√≥rio.
                  </div>
                </div>
              </div>

              <div class="form-card">
                <h3 class="form-card-title">
                  <span class="card-icon">üí°</span>
                  Dicas de Escrita
                </h3>
                
                <ul class="tips-list">
                  <li>Use dados e estat√≠sticas para embasar seus argumentos</li>
                  <li>Inclua exemplos pr√°ticos e dicas aplic√°veis</li>
                  <li>Mantenha par√°grafos curtos e linguagem clara</li>
                  <li>Cite fontes confi√°veis quando necess√°rio</li>
                </ul>
              </div>

              <div class="form-card">
                <h3 class="form-card-title">
                  <span class="card-icon">‚ö†Ô∏è</span>
                  Processo de Revis√£o
                </h3>
                
                <div class="review-steps">
                  <div class="step">
                    <div class="step-indicator yellow"></div>
                    <span>Artigo enviado para revis√£o</span>
                  </div>
                  <div class="step">
                    <div class="step-indicator blue"></div>
                    <span>An√°lise pela equipe editorial</span>
                  </div>
                  <div class="step">
                    <div class="step-indicator green"></div>
                    <span>Publica√ß√£o aprovada</span>
                  </div>
                </div>
                
                <p class="review-note">
                  O processo de revis√£o leva em m√©dia 2-3 dias √∫teis.
                </p>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="form-actions">
            <button 
              type="button" 
              (click)="onSubmit('draft')" 
              class="btn btn-outline"
              [disabled]="isSubmitting">
              <span class="btn-icon">üíæ</span>
              Salvar Rascunho
            </button>
            <button 
              type="submit" 
              class="btn btn-primary"
              [disabled]="isSubmitting">
              <span class="btn-icon">üì§</span>
              <span *ngIf="!isSubmitting">Enviar para Revis√£o</span>
              <span *ngIf="isSubmitting">Enviando...</span>
            </button>
          </div>
        </form>
      </div>

      <!-- Preview Tab -->
      <div class="tab-content" [class.active]="activeTab === 'preview'">
        <div class="preview-container">
          <div class="preview-card">
            <h3 class="preview-title">Pr√©-visualiza√ß√£o do Artigo</h3>
            
            <div class="preview-content" *ngIf="writeForm.get('title')?.value; else emptyPreview">
              <!-- Article Header -->
              <div class="preview-header">
                <div class="preview-category" *ngIf="writeForm.get('categorySlug')?.value">
                  <span 
                    class="category-badge" 
                    [style.background-color]="getCategoryColor(writeForm.get('categorySlug')?.value)">
                    {{ getCategoryName(writeForm.get('categorySlug')?.value) }}
                  </span>
                </div>
                
                <h1 class="preview-article-title">{{ writeForm.get('title')?.value }}</h1>
                
                <p class="preview-excerpt" *ngIf="writeForm.get('excerpt')?.value">
                  {{ writeForm.get('excerpt')?.value }}
                </p>

                <div class="preview-meta">
                  <div class="meta-left">
                    <div class="author-info" *ngIf="writeForm.get('author')?.value">
                      <span class="meta-icon">üë§</span>
                      <span>{{ writeForm.get('author')?.value }}</span>
                    </div>
                    <div class="meta-item">
                      <span class="meta-icon">üìÖ</span>
                      <!-- <span>{{ new Date().toLocaleDateString('pt-BR') }}</span> -->
                    </div>
                    <div class="meta-item" *ngIf="writeForm.get('content')?.value">
                      <span class="meta-icon">üïê</span>
                      <span>~{{ estimateReadTime(writeForm.get('content')?.value) }} min de leitura</span>
                    </div>
                  </div>
                </div>

                <div class="preview-tags" *ngIf="writeForm.get('tags')?.value">
                  <span 
                    class="preview-tag" 
                    *ngFor="let tag of writeForm.get('tags')?.value.split(',')">
                    {{ tag.trim() }}
                  </span>
                </div>
              </div>

              <!-- Article Content -->
              <div class="preview-article-content" *ngIf="writeForm.get('content')?.value">
                <div 
                  class="preview-prose" 
                  [innerHTML]="formatPreviewContent(writeForm.get('content')?.value)">
                </div>
              </div>
            </div>

            <ng-template #emptyPreview>
              <div class="empty-preview">
                <span class="empty-icon">üìÑ</span>
                <p>Preencha os campos para ver a pr√©-visualiza√ß√£o</p>
              </div>
            </ng-template>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
